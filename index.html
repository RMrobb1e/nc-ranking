<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Night Crows Growth Ranking</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800">
  <div class="max-w-3xl mx-auto p-6 mt-10 bg-white rounded-2xl shadow-lg">
    <h1 class="text-2xl font-bold mb-4">Night Crows Growth Ranking Search</h1>
    <div class="flex items-center gap-4 mb-6">
      <input type="text" id="ignInput" placeholder="Enter IGN" class="w-full p-3 border rounded-lg" />
      <button onclick="searchIGN()" class="bg-blue-600 text-white px-5 py-3 rounded-lg hover:bg-blue-700">
        Search
      </button>
    </div>
    <div id="resultArea" class="mt-6"></div>
  </div>

  <script>
    async function searchIGN() {
      const ign = document.getElementById("ignInput").value.trim();
      const resultArea = document.getElementById("resultArea");
      resultArea.innerHTML = "";

      if (!ign) {
        resultArea.innerHTML = "<p class='text-red-500'>Please enter an IGN.</p>";
        return;
      }

      // const url = `https://www.nightcrows.com/_next/data/gS2eBBlYqbNdFFZodjSYl/en/ranking/growth.json?regionCode=2020&wmsso_sign=check&keyword=${encodeURIComponent(ign)}&rankingType=growth`;
      const url = `http://localhost:3000/api/growth?ign=${encodeURIComponent(ign)}`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        console.log(data)
        const items = data.pageProps.rankingListData.items;

        if (!items || items.length === 0) {
          resultArea.innerHTML = "<p class='text-gray-500'>No data found for that IGN.</p>";
          return;
        }

        const item = items[0];

        resultArea.innerHTML = `
          <div class="border rounded-lg p-4 bg-gray-50">
            <h2 class="text-xl font-semibold mb-2">Character: ${item.CharacterName}</h2>
            <table class="w-full text-sm text-left">
              <tbody>
                <tr><td class="font-semibold">Rank</td><td>${item.rank}</td></tr>
                <tr><td class="font-semibold">Score</td><td>${item.score}</td></tr>
                <tr><td class="font-semibold">Realm</td><td>${item.RealmName}</td></tr>
                <tr><td class="font-semibold">Region</td><td>${item.RegionName}</td></tr>
                <tr><td class="font-semibold">Guild</td><td>${item.GuildName || '-'}</td></tr>
                <tr><td class="font-semibold">Guild Union</td><td>${item.GuildUnionName || '-'}</td></tr>
                <tr><td class="font-semibold">Max Rank Date</td><td>${new Date(item.MaxRankDate).toLocaleString()}</td></tr>
              </tbody>
            </table>
          </div>
        `;
      } catch (err) {
        resultArea.innerHTML = `<p class='text-red-500'>Failed to fetch data. Try again later.</p>`;
        console.error(err);
      }
    }
  </script>
</body>

</html>